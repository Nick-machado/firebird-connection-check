import { useMemo, useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Tooltip, TooltipContent, TooltipTrigger } from "@/components/ui/tooltip";
import { formatCompactCurrency, formatPercent, formatNumber } from "@/lib/formatters";
import type { DadosRegionais } from "@/lib/regionalProcessing";
import { calcularCorGradiente, calcularRangeValores } from "@/lib/regionalProcessing";

// SVG paths para cada estado brasileiro
const ESTADOS_PATHS: Record<string, string> = {
  AC: "M79.7,206.7l-5.8,3.9l-4.3-0.6l-2.9-2.4l-5.4,0.8l-4.3,4.5l-3.1,0.6l-1.4,2.4l-9.3,0.5l-2.9-1.8l-2-4.8l1.3-4.9l-2.3-4.1l3.2-6.9l-0.2-3l1.8-2.6l4.7-0.1l5.2-3.4l2-0.1l2.1,2.4l-0.9,2.7l1,1.2l0.2,3.9l5.1,5.4l4.2,0.5l1.5-0.5l6.2,3.2l4.9,2.9l1.5,1.4Z",
  AL: "M559.8,225l4.4-1.6l7.9-0.7l5.1,3.9l-0.5,8.9l-1.6,2.9l-3.5,1.6l-5.6-4.4l-3.7-5.9l-2.5-4.7Z",
  AM: "M68.5,109.2l5.9,0.9l3.7,2.7l0.1,2.6l5.7-0.5l7.3,3.5l4.3-0.8l3.2,1.5l4.7,4.3l4.5,0.2l0.7,1.6l-1.8,3.7l7.3-0.6l9.2,2l3.4,1.7l0.3,2.7l-1.9,2.7l0.3,3.7l3.5,1.9l1.2,2.5l6.6,0.9l3.1-1.6l7.7,0.9l-0.3,9.9l4.7,3.4l0.2,4.9l2.4,3.9l-0.7,3.2l4.1,3.3l1.8-2.3l3.9,0.7l2.8-1.2l2.8,0.5l0.1,1.9l2.7,1.5l-0.9,7.5l5.1,6.2l0.2,5l3.7,1l1.2,2.6l-0.9,1.2l-3.7-0.9l-3.7,2.7l-3.4,0.1l-1.9,2.5l-6.2,0.6l-1.4,1.4l-9.4-0.2l-4.2,0.8l-5.6,3.8l-5.4,0.5l-0.3,5.7l-3.6,0.9l-0.5-3.5l-6.2-2l-3.7,1.7l-1.5-3.6l-5.1,0.4l-1.7-3.5l-1.6,0.2l-1.5,3.4l-5.9-0.3l-2.7,0.8l-6.9-3.5l-1.5,1.2l-5-0.9l-4.9-4.3l-2.7-0.3l-3.7,3l-9.3-0.5l-6.6-6.7l-5.7-0.6l-0.9,0.6l-7-1.6l-3.4,0.9l-2.9-4.6l-1.7-6.5l2-3.1l-1.9-5.9l-5.2,1.2l-5.7-4.4l0.9-4.4l-1.9-4.9l-4.4-3.7l2.8-1.9l6.9,1.7l2.7-3.3l6.9,2.9l2.7-0.3l5.6-5.5l4.6,0l5.6-4.5l-0.7-1.9l2.6-2.2l9.9-4.9l2.7-5.9l8.2-2.2l4.5-6.1l2.6,0.3Z",
  AP: "M302.2,104.6l2.4,0.7l0.9,3.9l-2.3,2.7l2.4,2.9l3.7,0.3l0.9,2.7l3.3,1.9l2.9-1.3l-0.1-3.9l-1.9-2.7l0.2-4.9l3.9-1.5l3.2,0.9l4.7,1.1l2.5,2.3l0.9,3.9l-1.5,9.9l-3.7,4.8l-3.9,3.2l-1.8,2.9l-3.4,0.3l-5.2-4.1l-7.2-1.6l-4.2,0.4l0.3-3.7l1.9-2.3l0.9-7.4l-2.7-4.9l0.6-5.5l3.8-0.1Z",
  BA: "M456.2,203.7l4.2-0.4l4.3,1.5l2.7,3.9l3.3,2.9l7.2-0.5l3.2,0.9l5.1-5.3l5.4-1.9l5.9-4.4l2.1-5.7l4.7-4.1l2.9-0.4l3.1-2.9l4.2-0.2l5.4-4.8l5.5-1.5l10.2-7.9l2.9-4.1l4.7-2.9l2.8-0.2l6.9,4.9l4.3,0.3l4.5,3.9l0.9,3.7l2.7,4.5l0.9,4.4l-3.5,1.9l1.3,7l-0.5,7.6l0.9,5.7l3.7,1.3l1.5,5.5l-3.2,7.9l-0.3,5l1.1,4.9l-2.5,11.3l-2.8,2.5l-0.3,2.7l-2.8,4l1.2,2.7l-3.9,2.5l-0.5,4.1l-5.9,5.9l-5.9-0.5l-2.9-2.4l-3.7,1.4l-7.7-0.5l-5.3,1.6l-3.1-4.1l-4.8-2.2l-3.5,2.2l-3.2-1.2l-4.4,0.5l-5.4-3.9l-4.2-0.2l-1.9-1.8l-0.1-6.3l-2.5-3.6l-1.9,0.7l-5.5-5.7l0.6-3.7l-3.1-3.9l-0.7-3.8l-6.5-5.9l-2.2-5.3l0.5-10.3l-1.4-6.5l-5.3-5.3l-1.5-5.4Z",
  CE: "M481.8,163.1l4.2-0.5l2.4,2.9l1.9-0.3l4.9,1.9l6.7-3.7l2.7,0.5l8.3-1.5l1.9,1.4l0.9,3.3l3.9,0.9l0.9,3.9l2.7,0.7l1.1,3.9l-1.2,3.4l3.9,2.1l-0.9,4.7l-2.5,3.9l-3.2,2.5l-1.4,6.4l-3.5,2.9l-2.3-2.9l-3.7-1.2l-1.9,0.6l-2.9,5.9l-4.5,1.2l-2.9-0.3l-4.2-4.9l-6.9,4.9l-2.7-0.3l-3.9-3.9l-6.9,2.7l-0.7-5.5l0.9-4.6l2.9-0.9l-0.9-6l2.9-1.4l0.9-4.6l3.9-1.9l0.5-5.5l-0.7-3.9l2.2-3.7l2.4-0.3Z",
  DF: "M380.1,263.2l2.9,3.9l-0.9,5.2l-6.7,0.3l-1.4-3.7l0.3-3.9l5.8-1.8Z",
  ES: "M500.5,298.2l2.9-0.5l7.3,4.8l5.5,0.5l0.9,3.7l5.2,5.5l-0.9,9.2l-2.9,5.2l0.3,3.9l-2.5,3.2l-4.5,0.3l-4.3-2.9l-6.3-12.7l-1.2-6.6l0.2-5.5l0.3-8.1Z",
  GO: "M355.4,234.4l4.4,1.1l4.2,3l6.2-0.1l6.8-5.2l5.9-1l3.3,0.8l5.9,4.2l6.7-0.1l2.4,2.9l-2.3,3.5l0.5,4.8l-2.5,0.5l-2.9,4l1.7,3.7l-0.8,5.5l0.6,4.7l4.9,4.1l-0.5,1.9l-4.7,0.7l1.2,5l-1.1,3.7l3.5,3.8l1.2,4.2l4.7,4.3l-0.5,1.6l3.5,4.9l-0.3,2.8l-4.9,0.2l-5.5-0.9l-7.5,2.7l-2.9,3.4l-3.9-0.2l-2.4-4.7l-6.9,0.9l-0.5-4.2l-3.6-3.9l-0.5-3.5l-2-2.2l0.6-6.9l-4.9-4.1l-4.5,0.3l-3.9,2.9l-8.9,0.7l-1.4-4.2l0.7-5.9l-4.2-3.9l0.9-7.2l3.5-0.7l4.5-9.2l2.5-3.3l0.7-5.9l4.2-3l5.5-1.1Z",
  MA: "M354.5,145.4l3.7,0.3l4.5,5.9l6.9,3.7l1.1,3.7l-0.7,3.9l1.2,3.5l-0.7,2.7l2.5,3.2l3.2,0.9l0.3,2.5l-3,2.9l0.8,3.9l5.1-0.9l2.9,0.3l4.5-2.9l5.5,0.3l4.9,2.1l8.5,0.5l5.5-1.9l1.4,0.7l0.9,9.5l-2.7,3.1l-6.9,0.3l-1.9,2.5l-3.7,0.7l-0.9,3.2l-3.5,1.4l-3.2,0.3l-1.8-3l-4.9,0.5l-1.5,4.7l-2.8-0.5l-0.9,2.7l-3.8,2.5l-5.4-5.6l-5.4,1.4l0.7-3.2l-4-2.7l2.4-4.6l-3.5-7.1l2.3-0.8l-0.3-5.5l-5.1-2.2l-3.5-8.9l-7.5-8.5l-0.1-4.5l-2.5-0.9l0.9-3.2l-4.3-1.7l-5.5-0.3l0.3-5.7l4.5-0.1l3.5-3.5l0.5-1.5l4.4,0.5Z",
  MG: "M396.7,271.3l3.7,3.9l7.7,0.5l3.5,3.1l5.5,0.5l4.5-2.3l3.9,0.7l4.2-2.5l7.9-0.3l8.5-3.4l3.4-0.2l4.2,4.5l4.2,0.7l5.5-2.9l1.4,0.5l2.7,5.5l6.9,2l3.5-2l7.7,0.5l2.9,3.2l1.9,0.5l2.3,5.7l4.7-1.7l1.2,0.7l0.9,5.9l3.9,4.5l-1.5,3.2l1.9,5.7l-1.3,6.5l4.2,5.5l-1.7,3.9l-0.3,5l-4.9,3.2l-1.9,2.7l0.9,2.9l-3.4,2.9l-2.9,6.2l-3.9-0.5l-4.7,2.2l-3.5-2.7l-3.9,1.5l-2.5-1.4l-2.1-6l-5.9,0.5l-2.3,2.2l0.3,2.7l-4.5,0.7l-0.9,4.2l-4.9,5.2l-2.9,0.3l-4.5-3.4l-3.9,0.9l-2.5-1.4l0.5-3.2l-2.4-3.5l-5.9-2l-3.9,0.9l-3.7-5.9l-5.5-0.7l0.5-4.2l-2.2-1.2l-1.9-4l-3.7-2.2l-3.5,1.9l-7.9-5.7l-2.7-4.9l-2.5,0.3l-1.9-3.5l-4.5-2.3l0.9-4.9l4.5-0.5l0.7-3l-3.2-3.5l1.5-3l-3.2-4.5l-5.5-3.9l0.3-2.7l4.9-0.5l0.3-2.9l-3.7-4.4l-1.2-4.5l-3.5-3.5l1.3-4.9l6.5,1.7l7.5-2.5l5.5,1.2l5.5-0.2Z",
  MS: "M310.4,282.9l4.9,4.7l5.9-2.2l5.3,0.2l3.9,5.2l6.9-1.5l2.9,0.5l1.5,3.7l3.9-0.7l2.2,2.7l-0.5,3.7l0.9,3.7l4.9,4.7l4.2-0.3l3.9-3.2l4.2-0.5l0.7,6.5l-1.5,9.9l-0.5,7.5l-3.5,4.2l-0.3,6.9l3.2,5.2l-0.5,5.2l-3.2,3.5l-0.3,3.9l-15.9,1.1l-10.9-0.9l0.2-5l-7.5-7.2l-8.9-3.7l-3.9-4.2l-10.7-4.9l-3-5.7l0.2-3l-8.5-8.5l0.9-10.5l4.5-6.9l0.5-5.5l2.7-3.9l-0.9-5.9l2.7-2.4l8.2,1l3.2-2.7Z",
  MT: "M255.2,175.4l3.9,0.3l3.2-5l5.4,0.9l4.7,3.2l1.3,3.2l4.5,2.2l1.9,2.7l5.3,0.5l4.2,2.7l3.5-1.2l3.2,0.7l2.7,3l2.3,0.7l0.3,5.7l3.7,5.5l0.9,4.7l-2.9,9.5l0.7,6.9l-1.2,4.9l1.2,3.5l-0.9,5.5l-3.7,5.7l-0.1,2.9l2.7,1.9l-1.2,3.9l0.7,3.4l4.2,4.5l-0.5,3.5l3.5,0.5l-0.7,9.2l1.2,3.9l6.4,2.9l-3.4,4.5l-4.5,0.2l-2.9,2.9l-8.2-0.7l-3.9,2.7l-1.9,5.9l-5.5,2.5l-4.5-4.5l-6.7,0.5l-4.5-1.2l-4.2,0.3l-1.7,4.2l-6.9,0.9l-9.9-1.5l0.3-22.9l-1.9-12.5l0.5-31.5l-2.9-3.7l-4.7-0.9l-1.9-3.5l-5.1-1.2l-2.9-6l5.5,0.3l4.7-1.7l1.2-2.9l5.9-3.9l0.9-3.7l-1.9-4.9l2.1-3.7l0.1-6.5l1.9-1.2Z",
  PA: "M226.3,109.1l4.4-0.5l3.2-4.6l2.9,0.3l2.8,4.3l-0.5,4.9l3.7,0.7l1.7,6.4l5.9,1.7l0.9,1.5l-0.9,3.2l1.5,4.9l3.2,2.5l1.5,4.4l8.2,0.9l3.2-4.9l-0.5-3.9l1.4-1.9l0.5-4.5l3.9-0.5l3.5,0.3l0.9-5.2l5.2-0.5l0.9-4.9l3.3,0.3l0.5,3.9l5.2,0.5l3.3,3.5l3.7-0.5l4.9,2.5l5.4,0.5l0.5-3.5l5.2,0.5l2.9,1.9l2.7-0.3l4.9,4.2l3.9-3l8.7-3.5l4.7,0.3l3.2,2.5l0.9,5.2l4.9,4.2l6.9,1.9l0.9-1.9l-3.2-1.9l-0.5-2.9l6.9-0.9l5.5,2.2l7.7-0.3l5.9,2.5l5.9-0.5l-0.5,6.5l3.7,2.5l-0.5,5.5l-2.9,3.2l0.3,3.2l-3.9,3.5l-4.2,0.3l-0.7,3.2l-5.4-0.5l-3.5,3l-5.5,0.5l0.3,4.5l7.7,8.7l3.5,8.7l4.9,2.5l0.7,5.5l-2.7,0.9l4,7.2l-2.4,4.5l3.5,2.5l-0.7,2.9l5.9,5.5l-5.5-1.5l-3.9,1.5l-0.9-1.5l-3.9,0.2l-3.9-4.9l-5.5,0.5l-3.9,3.5l-5.9-0.7l-6.2,3l-0.5-3.9l-3.2-2l-1.9-7.5l-5.5-1.4l-3.9,0.4l-0.9,2.5l-3.9-1.5l-7.9,0.3l-1.9-2.5l-4.9-1.2l-3.9-4.5l-2.9,0.5l-5.2-2.9l-1.4,4.2l-3.9,0.9l-2.9,2.9l-1.9,6.2l-4.9,3.9l0.3,3.5l-3.2,0.5l-0.5-3.5l-1.4-1.5l0.5-2.5l-5.5-5.9l-3.2-0.5l-3.7,2l-2,3.5l-9.1,0.2l-2.2-0.9l1.4-7.9l-5.2-6.2l0.7-7.2l-2.5-1.4l0.3-2.5l-3.2-0.9l-3.7,1.5l-2.7-0.5l-4.2,2.9l-1.5-2.4l-4.2-0.7l-3.9,2.9l-0.5-4.2l-2.5-3.9l-0.5-5l-4.7-3.2l0.5-10.2l-7.9-1.2l-3.2,1.7l-6.5-0.9l-1.2-2.7l-3.2-1.9l-0.5-3.5l1.9-2.9l-0.5-3.5l-3.5-1.9l-0.5-3.2l-9.2-2l-7.5,0.7l1.9-3.9l-0.9-1.5l-4.2-0.5l-4.9-4.5l-3.5-1.2l-4.2,0.7l-7.2-3.7l-5.9,0.7l-0.5-3.2l-3.9-2.5l12.2,0.1l0.3-7.7l1.2-2.9l3.7,2.7l4.5,0.5l14.7-0.3l-0.5-7l2.5-2.2l4.4,0.5l0.9,2.9l6.5-0.5l3.9,2.5l3.5-2.5l4.7,0.5l5.9,2.9l5.2-0.7l2.2,1.2l5.4,0.3l3.2-5l2.2-0.5Z",
  PB: "M524.8,191.9l3.5-0.3l8.9,3.5l2.5-0.7l6.9,0.9l5.5-1.7l9.2,0.5l1.7,3.4l-4.2,1.5l-5.2-0.5l-8.2,0.9l-6.5,2.5l-4.5-0.3l-4.5,1.9l-3.9-0.7l-3.4-3.9l-1.2-4.1l2.9-1.4l0.5-1.5Z",
  PE: "M522.2,207.5l6.3,1.5l5.5-2l5.2,0.3l6.9-2.5l7.5-0.7l5.7,0.3l3.5,1.9l-2.9,2.7l3.7,1.2l3.9,4.5l1.2,3.9l-1.5,0.9l0.5,3.5l-4.2-0.5l-4.2,1.5l-5.9-3.7l-10.2,0.3l-7.5,2.4l-3.5-0.5l-3.5,1l-5.2-4.2l-7.9,0.7l-4.2,1.7l1.5-6.5l4.7-3.2l3.7-1l0.5-1.7Z",
  PI: "M409.2,145.4l5.5,0.9l3.9-0.3l6.9-6.5l6.2-1.2l7.9,0.5l7.2,5.9l4.9,0.3l3.2,3.2l6.2,1.9l1.9,3.4l3.9,0.2l1.4,3.5l6.5,6.7l-0.9,6l-2.9,0.7l0.7,5.9l-0.7,4.5l-4.2,1.7l-0.5,5.9l-3.5,1.5l-1.2,4.7l-4.2,4.5l-0.3,2l2.7,0.3l6.7-4.9l4.5,4.9l2.9,0.5l4.5-1.5l2.9-5.9l1.9-0.5l4.2,1.2l2,2.5l-0.5,5.9l-10.4,7.9l-5.5,1.7l-5.5,4.7l-4.2,0.5l-3.2,2.9l-2.9,0.5l-5.2,4.7l-2.9-0.7l-3.9-4.9l-2.9-0.5l-5.9,1.9l-7.2,0.5l-3.5-2.9l-2.9-3.9l-4.2-1.2l-4.2,0.5l0.9-5l-1.2-3l0.9-4.7l1.5-2l-1.3-8.9l0.3-6.4l-2.7-3.9l0.9-7.7l-2.2-6.5l2.2-5.2l-1-5.2l0.7-5.7Z",
  PR: "M336.4,340.7l3.5,2.7l4.2,1.2l1.9,2.5l5.5,2l1.5,3.2l4.9,3.2l3.4,0.7l2.2,3.3l6.5,4.4l0.5,1.5l4.5,1.9l5.2,0.3l4.5,2.5l5.2-0.5l5.2,2.7l4.7-1.7l4.7,0.7l5.2-2.9l0.5-1.2l-3.2-4.5l0.7-4.9l3.7-4.5l4.9-2.9l8.5-3l2.2-0.3l-0.3,2.7l3.9,3.2l-0.5,1.5l0.9,1.7l-1.5,2.5l-0.3,4.7l-3.2,2.2l0.9,1.9l-1.9,1.2l-4.9,0.5l-4.5,2.2l-3.5,5.4l-3.7,1l-5.5,4.7l-3.7,1.7l-0.9,3.5l-3.9,2.9l-1.7,5l-3.9,1.2l-3.5-1.7l-3.5,0.5l-6.5-2.5l-4.5,1l-0.9-1.5l-7.9-3.2l-3.5,0.7l-5.5-2.5l-4.7-0.5l-4.7-3l-10.7-3.9l-4.7,1l-2.5-2l3.2-3.2l0.3-4.5l3.4-3.5l0.2-5l-3.5-5.4l15.2-0.9l10.9,0.7Z",
  RJ: "M459.4,345.6l4.2,0.9l5.5,4.2l4.9,0.2l9.5,5.2l7.9,6.9l3.2,0.2l2.5-1.2l3.5,3.2l3.7-0.5l5.5,1.9l3.2-0.9l3.9,0.9l-2.2,3.9l2.2,1.5l-1.5,1.7l1.7,1.9l-2.5,0.5l-1.7,3.2l-4.9-0.5l-6.9-3.7l-10.5-2.5l-9.2-5.7l-6.2-0.9l-3.7-2.9l-4.5,0.7l-2.9-1.2l-2.5,0.5l-3.5-3.2l1.5-5.5l0.5-3l2.5-0.9l0.3-3.2l-2.5-2Z",
  RN: "M519.7,175.9l5.2,0.9l2.1,2.7l5.9,1l7.2-2.9l8.2,3l3.7,2.3l3.9,5.5l-1.5,2.5l-5.9,2.7l-6.9-0.7l-2.7,0.7l-9.2-3.5l-3.5,0.5l-0.7,1.7l-6.5-6.4l-1.2-3.5l-3.5-0.2l0.9-4.9l4.5-1.4Z",
  RO: "M181.5,188.9l-2.2,2.2l-4.9,0.5l-0.5,3.2l5.9,6.2l0.7,4l-3.5,4.5l0.5,2.7l-1.7,5l-5.5,2.9l-3.5,6.2l-0.9,4.5l-3.4,1.2l-0.5,2.7l-2.5,2.5l-5.2-0.2l-2.9-1.7l1.9-2.9l1.4-2.7l4.5-0.7l2.9-4.4l-1.5-1.2l0.3-4.2l-5-5.4l-0.2-3.9l-0.9-1.2l0.7-2.9l-2.2-2.2l-1.5,0.5l-4.2-0.7l-5.5-5.4l5.4-0.5l5.9-3.9l5.5-0.3l0.5,3.5l6.5,1.9l3.2-0.9l0.5-5.2l5.2-0.7l1.5-2.5l6.2-0.7l2-2.7l3.5-0.3l3.5-2.5l-0.3,2.7l-0.9,3.5l-5.5,3.2l-0.9,3.7l1.9,4.9l-0.9,3.5l-5.9,4.2l-1.5,3.2Z",
  RR: "M128.8,24.4l4.5,3.7l-0.3,3.9l4.7,1.2l6.5,7.2l8.5,2.4l2.9-2.5l5.4,0.9l2.9-2.3l7.2,5.9l1.5,4.9l-1.5,4l2.5,3.5l-0.9,2.9l3.2,3l0.9,2.5l-0.3,4.9l-3.7,1.7l1.7,2.9l-2.5,2l0.9,3.7l3.5,0.9l2.9,5.2l-0.3,1.5l3.7,0.5l2.5,2.3l-6.5,0.5l-0.9-2.9l-4.5-0.5l-2.2,2.2l-0.3,7l-12.2-0.3l-3.9,2.7l0.5,2.9l-3.7-0.9l-2.7,3.2l-7.2-1.9l-2.7,1.9l4.5,3.7l1.5,4.9l-0.7,4.4l-6.2-0.5l-4.2-2.9l-1.9-5.4l-8.5-4.5l-3.5-3.9l-0.3-4.2l-3.2-3.5l-0.9-4.2l3.5-3.5l-1.2-1.9l2.5-7.9l5.4-4.9l0.5-4.7l-2-6.7l0.5-5.5l2.5-2.5l-1.9-3.2l-0.9-8l1.9-2.7l5.9-0.3l4.9-3.2Z",
  RS: "M317.8,393.9l3.9,3.5l1.2,4.2l-0.5,5.7l-2.9,2.2l0.9,2l-0.5,5.9l5.9,5.9l2.5,0.5l3.9,5.2l5.5,4.7l6.2,1l0.9,2.5l-1.7,5.2l-0.5,4.5l-2.2,3.7l0.5,5l-3.7,2.5l-4.9,5.2l-6.2,2l-1.2,2.2l-5.2-0.9l-4.9,1.2l-5.9-2.5l-3.2,1.2l-3.9-2l-7.5-1.9l-4.9,1.5l-4.5-1l-4.5,2l-4.2-1.5l-2.9-3.2l3.9-2.2l0.9-2.9l4.9-2.9l2.9-5.9l0.9-5l-0.5-4.5l2.9-4.2l-0.9-6.2l-1.5-0.9l-0.9-5.2l-3.2-1.5l-3.5-4.7l1.5-1l-0.9-1.5l-3.9-0.9l-2.9,0.5l-0.5-4.9l-3.5-0.9l-0.5-2.5l-3.9-4.9l-0.3-1.5l4.9-0.3l3.9-4.2l2.7-1.5l7.2-0.7l8.7-4.2l4.2,2.9l4.5,0.5l5.2,2.5l3.5-0.7l7.7,3.2l0.9,1.5l4.5-0.9l6.5,2.2l3.2-0.5Z",
  SC: "M355.2,394.8l2.2,1.9l5.4-4.7l3.5-0.9l5.5-4.5l3.7-1.7l0.9-3.9l3.9-2.5l1.9-4.9l3.5-1.2l3.9,5.9l5.5,4.5l6.5,3.5l8.5,0.5l-0.5,1.9l-5.5,2.5l-0.5,2.7l1.2,2.9l-1.9,1.2l1.9,3l-3.5,0.9l-1.9,2.9l0.5,1.5l-3.5,0.9l-0.5,2.2l-9.5,3.7l-8.5,4.5l-6.9,0.5l-3.2,1.9l-4.7-0.5l-4.2-3l-0.5-4.2l-6.2-1l-4.9-4.5l-2.5-0.3l-5.5-5.7l0.5-5.9l-0.7-1.9l2.7-2l0.3-5.7l4.2,1.2l4.5-2l4.5,1l5.2-1.5Z",
  SE: "M555.2,237.9l5.9,5.5l0.5,3.5l-1.9,4.7l-1.2,6.2l-2.5,2.5l-5.5-5.9l-0.7-3.5l-5.2-4.7l3.2-1.5l1.9-3l5.5-3.8Z",
  SP: "M371.5,305.6l1.9,2l3.5-1.7l3.9,2.2l5.5,0.7l3.7,5.5l4.2-0.7l5.5,2l2.5-0.5l2.2,3.2l-0.5,3.5l2.5,1.5l4.2-0.9l4.5,3.2l2.9-0.5l4.9-4.9l0.9-4.5l4.5-0.9l-0.3-2.9l2.2-2.2l6.2-0.5l2.5,5.9l2.2,1.2l4.2-1.7l3.5,2.5l4.5-2.5l3.9,0.5l3-6.2l3.2-2.7l-0.9-2.9l1.9-2.7l4.9-3.4l0.3-4.5l1.5-3.9l-4.2-5.4l1.4-6.2l-2.2-5.7l1.5-3.5l-3.7-4.2l-0.9-5.9l-7.9-0.7l-4.9,1.9l-2.7-5.5l-1.5-0.5l-5.7,2.9l-4.2-0.7l-4.2-4.5l-3.7,0.2l-8.5,3.2l-7.9,0.5l-4.2,2.5l-3.9-0.7l-4.5,2.2l-5.5-0.5l-3.5-3.2l-7.7-0.7l-3.7-3.5l-1.2,4.9l3.5,3.2l3.2,4.5l-1.5,3.2l3.4,3.5l-0.9,3.2l-4.2,0.5l-0.9,4.5l5.5,3.9l3,4l-1.5,5.2l-0.5,6.5l-3.5,4.5l-0.3,7.4Z",
  TO: "M357.2,153.9l5.5,0.5l3.5,1.5l-0.9,4.9l1.5,4.4l4.2-1.9l0.7-3.5l5.9,0.7l3.2-3.7l2.9,0.5l4.5,5.4l0.5,5l-0.9,8l2.2,6.2l-0.7,7.9l2.5,3.5l-0.5,6.2l1.5,8.9l-1.5,1.9l-0.7,4.5l1,3l-0.9,5.7l-6.5-0.5l-3.9-3.7l-6.5-0.5l-2.5-3l0.5-5l-3.9-0.5l-6.2,5.2l-6.5,0.5l-4.5-1.2l-4.2-2.7l-1.2-4l6.5-2.2l-1.5-4.5l0.7-10l3.7-3l-0.5-3l-3.7-0.5l-2.7-3.5l0.9-5.2l-1-3.5l1.5-4.9l-0.5-7.5l2.7-9.2l-0.9-5l-3.5-5.2l0.5-6Z",
};

// Mapeamento de UF para nome completo
const UF_NOMES: Record<string, string> = {
  AC: "Acre", AL: "Alagoas", AM: "Amazonas", AP: "Amapá",
  BA: "Bahia", CE: "Ceará", DF: "Distrito Federal", ES: "Espírito Santo",
  GO: "Goiás", MA: "Maranhão", MG: "Minas Gerais", MS: "Mato Grosso do Sul",
  MT: "Mato Grosso", PA: "Pará", PB: "Paraíba", PE: "Pernambuco",
  PI: "Piauí", PR: "Paraná", RJ: "Rio de Janeiro", RN: "Rio Grande do Norte",
  RO: "Rondônia", RR: "Roraima", RS: "Rio Grande do Sul", SC: "Santa Catarina",
  SE: "Sergipe", SP: "São Paulo", TO: "Tocantins",
};

type Metrica = "faturamento" | "margem" | "quantidade";

interface BrazilMapProps {
  dados: DadosRegionais[];
  metrica: Metrica;
  onEstadoClick: (uf: string) => void;
  estadoSelecionado: string | null;
}

export function BrazilMap({ dados, metrica, onEstadoClick, estadoSelecionado }: BrazilMapProps) {
  const [estadoHover, setEstadoHover] = useState<string | null>(null);

  // Criar mapa de UF -> dados para acesso rápido
  const dadosPorUF = useMemo(() => {
    const map = new Map<string, DadosRegionais>();
    dados.forEach((d) => map.set(d.uf, d));
    return map;
  }, [dados]);

  // Calcular range para gradiente de cor
  const range = useMemo(() => calcularRangeValores(dados, metrica), [dados, metrica]);

  const getCorEstado = (uf: string) => {
    const dado = dadosPorUF.get(uf);
    if (!dado) return "hsl(var(--muted))";
    return calcularCorGradiente(dado[metrica], range.min, range.max);
  };

  const formatarValorMetrica = (valor: number, tipo: Metrica) => {
    if (tipo === "faturamento" || tipo === "margem") {
      return formatCompactCurrency(valor);
    }
    return formatNumber(valor);
  };

  return (
    <Card className="h-full">
      <CardHeader className="pb-2">
        <CardTitle className="text-lg">Mapa de Vendas por Estado</CardTitle>
      </CardHeader>
      <CardContent>
        <svg
          viewBox="0 0 600 500"
          className="w-full h-auto"
          style={{ maxHeight: "500px" }}
        >
          {Object.entries(ESTADOS_PATHS).map(([uf, path]) => {
            const dado = dadosPorUF.get(uf);
            const isSelected = estadoSelecionado === uf;
            const isHovered = estadoHover === uf;
            
            return (
              <Tooltip key={uf}>
                <TooltipTrigger asChild>
                  <path
                    d={path}
                    fill={getCorEstado(uf)}
                    stroke={isSelected ? "hsl(var(--primary))" : isHovered ? "hsl(var(--foreground))" : "hsl(var(--border))"}
                    strokeWidth={isSelected ? 2.5 : isHovered ? 1.5 : 0.5}
                    className="cursor-pointer transition-all duration-200"
                    onClick={() => onEstadoClick(uf)}
                    onMouseEnter={() => setEstadoHover(uf)}
                    onMouseLeave={() => setEstadoHover(null)}
                    style={{
                      filter: isSelected ? "drop-shadow(0 2px 4px rgba(0,0,0,0.3))" : "none",
                    }}
                  />
                </TooltipTrigger>
                <TooltipContent side="top" className="z-50">
                  <div className="text-sm">
                    <p className="font-semibold">{UF_NOMES[uf]} ({uf})</p>
                    {dado ? (
                      <>
                        <p>Faturamento: {formatCompactCurrency(dado.faturamento)}</p>
                        <p>Margem: {formatCompactCurrency(dado.margem)} ({formatPercent(dado.margemPercentual)})</p>
                        <p>Quantidade: {formatNumber(dado.quantidade)}</p>
                        <p>Notas: {formatNumber(dado.notas)}</p>
                      </>
                    ) : (
                      <p className="text-muted-foreground">Sem dados</p>
                    )}
                  </div>
                </TooltipContent>
              </Tooltip>
            );
          })}
        </svg>

        {/* Legenda */}
        <div className="flex items-center justify-center gap-2 mt-4">
          <span className="text-xs text-muted-foreground">Menor</span>
          <div
            className="h-3 w-32 rounded"
            style={{
              background: `linear-gradient(to right, hsl(142, 20%, 90%), hsl(142, 80%, 40%))`,
            }}
          />
          <span className="text-xs text-muted-foreground">Maior</span>
        </div>
        <p className="text-center text-xs text-muted-foreground mt-1">
          Clique em um estado para ver detalhes
        </p>
      </CardContent>
    </Card>
  );
}
